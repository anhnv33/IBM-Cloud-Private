# ICP Architecture
Created by AnhNV Created Date: 28/11/2017

This document provides informaion about the following:

- Overview ICP
- Architecture
- Components

**Reference**:
- [Prometheus server][prometheus-server]
- [Calico][calico-release]

## 1. Overview
* IBM Cloud Private version 2.1.0 has the following features and functions:
    * A unified installer
    * ICP management console: manage, monitor, and troubleshoot application and cluster from a single, centralized, and secure management console
    * Private Docker image registry: provide a local registry service that functions in the same way as the cloud-based registry service, Docker Hub. This local registry has all same features as Docker Hub but also allows yo to restrict which users can view or pull images
    * A catalog of containerized software and services: the environment must be connected to the internet for you to access the charts for these packages
    * Isolated Tenant Networks: Calico allows improved performance and network isolation inside cluster
    * Robust monitoring and logging with ELK stack: ICP uses Elasticsearch, Logstash, Filebeat, and Heapster for collection, storage, and querying of logs and metrics, also install Kibana or Grafana to query the data in Elasticsearch DB
* Architecture
    * ICP cluster has 4 main classess of nodes: boot, master, worker, and proxy
    * Optionally specify a management node in cluster
    * Boot node: is used for running installation, configuration, node scaling and cluster updates
    * Master node: provides management services and controls the worker nodes in a cluster
    * Worker node: provides a containerized environment for running tasks
    * Proxy node: trnsmits external request to the services created inside cluster
    * Management node: hosts management services like monitoring, metering, and logging
![](https://user-images.githubusercontent.com/14268190/33314936-c015962e-d461-11e7-9e95-f490a95b7a9a.png)

## 2. Components
* ICP has two main components: docker and Kybernetes
* Components:
    * Alert Manager: Handles alert by the Prometheus server, it takes care of deduplicating, grouping, and routing them to the correct receiver integration such as slack, email, PagerDuty
    ![image](https://user-images.githubusercontent.com/14268190/33357279-c9ded994-d4f3-11e7-9b21-9a52c040a785.png)
    * Ansible based installer and ops manager: deploys ICP on master and worker node
    * Authentication manager: provides an HTTP API for managing users
    * Calico/node: set calico network confifurations on each node
    * calicoctl: A client tool that runs as a Kubenetes job to set up overall calico configurations
    * calico/cni: set the network CNI plugins on each node
    * calico/kube-policy-controller: a controller center that sets the network policy in ICP cluster
    * Docker registry: (on each master node) private image registry that is used to store container image files, the docker distribution and registry version is API V2
    * Default backend: (single master node) 
    * Elasticsearch: (each master node) Stores the system and application logs and metrics, Elasticsearch also provides an advanced API that can be used for querying these logs and metrics
    * Filebeat: (runs on all master, worker, and proxy nodes) collects the logs for all system components, and user application containers that are running on each node
    * GlusterFS (run on selected worker nodes) : a storage file system
    * Heapster (single master node): connect to the kubelet that is running in each worker node and collects node and container metrics (CPU, memory, network usage)
    * Heketi (run as a pod on any worker node): CLI to manage GlusterFS
    * Helm (single master node): manage kubernetes charts
    * ICP management console (each master node): a web portal that is based on Open DC/OS GUI
    * 

[prometheus-server]: <https://prometheus.io/docs/introduction/overview/>
[calico-release]:<https://docs.projectcalico.org/v2.4/releases/>